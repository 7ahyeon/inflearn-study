# 모든 개발자를 위한 HTTP

## IP

### IP 인터넷 프로토콜 ; Internet Protocol
- 지정한 IP 주소(IP Address)에 패킷(Packet) 통신 단위로 데이터 전달
- 변경될 수 있음

### 인터넷 프로토콜(IP)의 한계

|속성|설명|
|-|-|
|비연결성|패킷이 받을 대상이 없거나 서비스 불능 상태여도 패킷 전송|
|비신뢰성|중간에 패킷이 사라지거나 순서대로 오지 않을 수 있음|

### 인터넷 프로토콜(IP) 스택의 4계층

|계층|실재|
|-|-|
|애플리케이션|HTTP FTP|
|전송|TCP UDP|
|인터넷|IP|
|네트워크 인터페이스|랜 드라이버|

|계층|실재|순서|
|-|-|-|
|애플리케이션|웹 브라우저/네트워크 게임/채팅 프로그램<br>SOCKET 라이브러리|1. HTTP ; 메시지 생성<br>2. SOCKET 라이브러리 통해 전달|
|OS|TCP<br>IP|3. TCP 정보 생성(메시지 데이터 포함)<br>4. IP 패킷 셍성(TCP 데이터 포함)|
|네트워크 인터페이스|LAN 드라이버/장비|5. LAN카드를 통해 이더넷 프레임(Ehternet Frame ; MAC주소 등 물리적 주소 포함)(IP 패킷 포함)해서 인터넷으로 서버로 전달|

### TCP/IP 패킷
|구조|포함|
|-|-|
|IP패킷|출발지IP, 목적지IP 등|
|TCP세그먼트|출발지PORT, 목적지PORT, 전송 제어, 순서, 검증 정보 등|
|전송 데이터|실제 데이터|

## TCP/UDP

### TCP 전송 제어 프로토콜 ; Transmission Control Protocol
- 연결 지향 ; TCP 3 Way Handshake/ing (가상 연결)
- 데이터 전달 보증
- 순서 보장
- 신뢰할 수 있는 프로토콜 ; 현재는 대부분 TCP 사용

### TCP 3 Way Handshake (가상 연결)
1. 클라이언트 > SYN ; 접속 요청 > 서버
2. 클라이언트 < SYN + ACK ; 요청 수락 < 서버
3. 클라이언트 > ACK (+데이터)  > 서버
4. 클라이언트 > 데이터 전송 > 서버 

- SYN ; Synchronize ; 일치시키다
- ACK ; Acknowledgment ; 승인

### UDP 사용자 데이터그램 프로토콜 ; User Datagram Protocol
- 흰 도화지 ; 연결지향 X 데이터 전달 보증 X 순서 보장 X
- IP와 거의 같음 ; **+ PORT +CheckSum** ; 단순하고 빠름
- 애플리케이션 추가 작업 필요
- HTTP3 > UDP 사용하면서 요즘 각광

## PORT

### PORT
- 같은 IP 내에서 프로세스/애플리케이션 구분
- 0 ~ 65535 할당 가능 ; 0 ~ 1023 (잘 알려진 포트 ; 사용 지양)
  - FTP ; 20, 21
  - TELNET ; 23
  - HTTP ; 80
  - HTTPS ; 443

## DNS

### DNS 서버 ; 도메인 네임 시스템 ; Domain Name System
- 전화번호부 같은 서버 
- 도메인명 > IP주소 변경

## URI

### URI ; Uniform Resource Identifier
- 리소스(자원)를 식별하는 통합된 방법
  - URL ; Uniform Resource Locator ; 위치
  - URN ; Uniform Resource Name ; 이름
- 위치는 변할 수 있지만, 이름은 변하지 않음
- 대체로 URI == URL 

### URL
- scheme://[userinfo@]host[:port][/path][?query][#fragment]
- https://www.google.com:443/search?q=hello&hl=ko

#### schme
- 주로 프로토콜 사용 ; 어떤 방식으로 자원에 접근할 것인가 하는 약속 규칙 (ex; http, https, ftp 등)

#### userinfo
- URL에 사용자 정보를 포함해서 인증 > 거의 사용X

#### host
- 호스트명 ; 도메인명 또는 IP 주소를 직접 사용 가능

#### port
- 포트번호 http:80 / https:443 > 생략 가능

#### path
- 리소스 경로
- 계층적 구조 (home/member/100)

#### query == query parameter/string
- key = value 형태
- ? ; 시작 & ; 추가
- 웹서버에 제공하는 파라미터/문자 형태

#### fragment
- html#spring-boot
- html 내부 북마크 등에 사용(서버 전송 정보X)

## HTTP 

### HTTP ; HyperText Transfer Protocol
- HTTP 메시지에 모든 형태의 데이터를 전송함
- 서버 간 데이터 송수신의 경우에도 사용
  - HTML, TEXT
  - 이미지, 음성, 영상, 파일
  - JSON, XML(API)
 - TCP ; 게임 등 특수한 경우(게임도 HTTP 사용 사례 있음)

### HTTP 역사
- HTTP/0.9 : 1991 : GET 메서드만 지원 (HTTP 헤더 X)
- HTTP/1.0 : 1996 : 메서드/헤더 추가
- **HTTP/1.1** : 1997 : TCP기반 / 가장 많이 사용(중요) / 이후는 성능 개선 
  - RFC2068(1997) > RFC2616(1999) > RFC7230~7235(2014)
- HTTP/2 : 2015 : TCP / 성능 개선
- HTTP/3 : 진행중 : TCP 대신 **UDP** 사용, 성능 개선

### HTTP 특징
- 클라이언트 서버 구조
- 비연결성 / 무상태 프로토콜(Stateless)
- HTTP 메시지를 통한 통신
- 단순함 / 확장 가능

#### 클라이언트 서버 구조
- Request Response 구조
- 클라이언트 ; 서버에 요청 전송/응답 대기
- 서버 ; 요청에 대한 결과 생성/응답 전송 > 클라이언트 동작
- 분리 중요 ; 서버 - 비즈니스 로직, 데이터 / 클라이언트 - UI/UX
  - 독립적 진행 가능

#### 무상태 프로토콜 ; Stateless (<>Stateful 상태 유지)
- 서버가 클라이언트 상태 보존 X / 응답 서버 쉽게 바꿀 수 있음 > 무한한 서버 증설 가능
- 장점 : 서버 확장성 높음 ; Scale out ; 수평 확장
- 단점 : 클라이언트 추가 데이터 전송 필요

#### 무상태 프로토콜 ; Stateless 실무 한계
- 무상태로 설계할 수 없는 경우 존재 ; 로그인 (브라우저 쿠키, 서버 세션 등)
- > 상태 유지는 최소한으로 유지함

#### 비연결성 ; Connectionless
- 장점
  - 서버 연결 유지X / 최소한의 자원 사용
    - TCP/IP ; 연결성 ; 서버 다중 연결 유지/자원 소모
  - 일반적으로 초 단위 이하의 빠른 속도 응답
  - 동시 처리 요청 적게 유지 / 서버 자원 효율적 사용 가능
- 한계
  - TCP/IP 연결 새로 갱신 - 3Way Handshake 시간 추가
  - 웹 브라우저로 사이트 요청시 HTML뿐만 아니라 수많은 자원(JS, CSS, 이미지 등) 함께 다운로드
  - 해결? HTTP 지속 연결 ; HyperText Transfer Protocol Persistent Connections > HTTP/2, HTTP/3에서 더 많은 최적화

#### HTTP 메시지

|start-line|시작 라인|
|-|-|
|header|헤더|
|**empty line**|공백 라인 ; CRLF ; 필수|
|message body||

- 요청

|GET/search?q=hello&hl=ko HTTP/1.1|시작 라인|
|-|-|
|Host: www.google.com|헤더|
||공백 라인 ; CRLF ; 필수|
||message body 없을 시 생략 가능|


- 응답

|HTTP/1.1 200 OK|시작 라인|
|-|-|
|Content-Type: text/html;charset=UTF-8<br>Content-Length: 3423|헤더|
||공백 라인 ; CRLF ; 필수|
|<html><br></html>|message body 없을 시 생략 가능|

- 응답 공식 스펙
  - HTTP-message = start-line
                    *( header-field CRLF )
                    CRLF
                    [ message-body ]

#### start-line
- 요청 : request-line / 응답 : status line
- request-line = method SP request-target SP HTTP-version CRLF
- status-line = HTTP-version SP status-code SP reason-phrase CRLF
  - SP ; Space ; 공백
  - CRLF ; Carriage-Return(\r) + Line Feed(\n) ; 엔터
  
- method ; GET, POST, PUT, DELETE ; 서버 수행 동작 지정
  - GET ; 리소스 조회 / POST ; 요청 내역 처리

- request-target ; absolute-path[?query] ; /로 시작하는 경로

- status-code
  - 200 ; 성공 / 400 ; 클라이언트 요청 오류 / 500 ; 서버 내부 오류

- reason-phrase ; 이유 문구 ; OK

#### header
- header-field = field-name ":" OWS field-value OWS
  - OWS ; Optional WhiteSpace ; 띄어쓰기 허용
  - 필드네임 뒤는 OWS X
- HTTP 전송에 필요한 모든 부가 정보
  - ex; 메시지 바디 내용/크기, 압축, 인증, 요청 클라이언트(브라우저) 정보, 서버 애플리케이션 정보, 캐시 관리 정보 등
- 표준 헤더 많음 / 필요시 임의 헤더 추가 가능

#### message body
- 실제 전송 데이터
- HTML 문서, 이미지, 영상, JSON 등 **byte**로 표현할 수 있는 모든 데이터 전송 가능

## HTTP Method

### HTTP Method
- GET : 리소스 조회
- POST : 요청 데이터 처리
- PUT : 리소스 대체(없을시 생성)
- PATCH : 리소스 부분 변경
- DELETE : 리소스 삭제
  - 기타
  - HEAD : 리소스 조회(메시지 바디 제외)
  - OPTIONS : 리소스 통신 가능 옵션(주로 CORS ; Cross-Origin Resource Sharing ; 교차 출처 리소스 공유 에서 사용)
  - CONNECT : 대상 자원으로 식별되는 서버에 대한 터널을 설정
  - TRACE : 대상 리소스에 대한 경로를 따라 메시지 루프백 테스트를 수
 
### GET
- 리소스 조회
- query-parameter/string 통해 전달(message-body 사용 가능/대개 지원하지 않음/권장x)

### POST
- 요청 데이터 처리
- message-body를 통해 서버로 요청 데이터 전달/서버 요청 데이터 처리 > 주로 신규 리소스 등록/프로세스 처리
- 대상 리소스가 리소스의 고유한 의미 체계에 따라 요청에 포함된 표현을 처리하도록 요청
  - 새 리소스 생성/등록
  - 요청 데이터 처리
  - 다른 메서드 처리 X (ex; JSON 조회 데이터)

### PUT / PATCH / DELETE
- 리소스 대체 (덮어쓰기) / 부분 변경 / 삭제
- 중요 ; 클라이언트가 리소스를 식별함 ; 리소스 위치를 통해 URL 지정해줘야함 (ex; /memebers/100)

## HTTP Method 속성

### 안전 Safe Methods
- 호출해도 리소스를 변경하지 않음
- GET, HEAD, OPTIONS, TRACE
- 로그가 쌓여서 장애 발생? 고려하지 않음

### 멱등 Idempotnet Methods
- f(f(x)) = f(x)
- 한 번 호출하든 백 번 호출하든 결과가 똑같음
  - GET, PUT, DELETE
  - POST X > 중복 결제 등
- 자동 복구 매커니즘 설계시 고려 필요
- 외부 요인으로 중간 리소스 변경까지는 고려하지 않음

### 캐시 가능 Cacheable Methods
- 응답 결과 리소스를 캐시해서 사용해서 되는지 고려 필요
- GET, HEAD, POST, PATCH 캐시 가능 > GET, HEAD만 캐시 사용
  - POST, PATCH ; 본문 내용까지 캐시 키로 고려해야함 (사용X)
 
## 클라이언트에서 서버로 데이터 전송

### 데이터 전달 방식
- 쿼리 파라미터 ; GET / 주로 정렬 필터(검색어)
- 메시지 바디 ; POST, PUT, PATCH / 회원 가입, 상품 주문, 리소스 등록, 변경

### 데이터 전달 상황
- 정적 데이터 조회 ; 이미지, 정적 텍스트 문서 ; GET (쿼리 파라미터 O)
- 동적 데이터 조회 ; 검색, 정렬 필터 ; GET (쿼리 파라미터 X)
- HTML Form / HTTP API ; 회원 가입, 상품 주문, 데이터 변경 

## HTTP API 설계 예시

### 문서 Document
- 단일 개념 ; 파일 하나, 객체 인스턴스, 데이터베이스 row
- 예시 /members/100

### 컬렉션 Collection
- 서버가 관리하는 리소스 디렉토리
- 서버 ; 리소스의 URI 생성 및 관리
- 예시 /mebers/id (/members : 컬렉션)

### 스토어 Store
- 클라이언트가 관리하는 리소스 저장소
- 클라이언트 ; 리소스의 URI 인지 및 관리
- 예시 /files/filename (/files : 스토어)

### 컨트롤 URI
- GET, POST ONLY 지원함
- HTTP 메서드로 해결하기 애매한 경우 사용(HTTP API 포함)
- ONLY 해결 위해 동사로 된 리소스 경로 사용
- 예시 POST의 /new /edit /delete





















